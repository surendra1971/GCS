steps:
  - name: 'gcr.io/cloud-builders/gsutil'
    id: Download init.json from bucket-demo-12
    args: ['cp', 'gs://bucket-demo-12/init.json', 'init-1.json']

  - name: 'gcr.io/cloud-builders/gsutil'
    id: Download init.json from bucket-demo-13
    args: ['cp', 'gs://bucket-demo-13/init.json', 'init-2.json']

  - name: 'ubuntu'
    id: Validate and Compare init.json files
    entrypoint: bash
    args:
      - -c
      - |
        apt-get update && apt-get install -y jq

        echo "ğŸ” Validating JSON files..."
        jq -S . init-1.json > sorted-1.json || { echo "âŒ init.json in bucket-demo-12 is invalid JSON"; exit 1; }
        jq -S . init-2.json > sorted-2.json || { echo "âŒ init.json in bucket-demo-13 is invalid JSON"; exit 1; }

        echo "ğŸ”„ Comparing JSON files..."
        if diff sorted-1.json sorted-2.json; then
          echo "âœ… Both init.json files in bucket-demo-12 and bucket-demo-13 are the same"
        else
          echo "âŒ init.json files in the two buckets are different"
          exit 1
        fi

options:
  logging: CLOUD_LOGGING_ONLY
