steps:
  - name: 'gcr.io/cloud-builders/gsutil'
    id: Download init.json from bucket-demo-12
    args: ['cp', 'gs://bucket-demo-12/init.json', 'init-1.json']

  - name: 'gcr.io/cloud-builders/gsutil'
    id: Download init.json from bucket-demo-13
    args: ['cp', 'gs://bucket-demo-13/init.json', 'init-2.json']

  - name: 'ubuntu'
    id: Validate and Compare JSON
    entrypoint: bash
    args:
      - -c
      - |
        apt-get update && apt-get install -y jq

        echo "üîç Validating and sorting JSON..."
        if ! jq -S . init-1.json > sorted-1.json; then
          echo "‚ùå init.json from bucket-demo-12 is invalid JSON"
          exit 1
        fi

        if ! jq -S . init-2.json > sorted-2.json; then
          echo "‚ùå init.json from bucket-demo-13 is invalid JSON"
          exit 1
        fi

        echo "üîÑ Comparing sorted JSON files..."
        if cmp -s sorted-1.json sorted-2.json; then
          echo "‚úÖ Both init.json files are identical in content"
        else
          echo "‚ùå init.json files are different"
          exit 1
        fi

options:
  logging: CLOUD_LOGGING_ONLY
